<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Theta Tau Attendance</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(rgba(245, 223, 135, 0.6), rgba(245, 223, 135, 0.8)),
                  url('tt_shield.png') repeat;
      background-size: 90px;
      z-index: -1;
    }

    .container {
      width: 90%;
      max-width: 800px;
      background-color: #fff4c7;
      border-radius: 16px;
      padding: 10px;
      box-shadow: 5px 5px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    h1 {
      background-color: #fff2c7;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 20px;
      box-shadow: 4px 4px 0px #d6b445;
      color: #8b0000;
      font-size: 2em;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #8b0000;
      margin-bottom: 20px;
      margin-top: 20px;
    }

    .scroll-box {
      max-height: 400px;
      overflow-y: scroll;
      background-color: #fff4d0;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid gold;
      text-align: center;
      color: #8b0000;
    }

    th {
      border-bottom: 2px solid gold;
    }

    tr:hover td {
      background-color: #fdf2c2;
    }

    .low {
      color: red !important;
    }

    .high {
      color: green !important;
    }

    .name-low {
      font-weight: bold;
      color: red !important;
    }

    #popupModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-content {
      background-color: #fff0c9;
      border-radius: 16px;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: relative;
      text-align: left;
    }

    .popup-content h2 {
      font-family: Arial, sans-serif;
      color: #8b0000;
      margin-top: 0;
    }

    #closePopup {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 28px;
      color: #8b0000;
      cursor: pointer;
    }

    .popup-section {
      background: #fff9db;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
    }

    .popup-row {
      font-family: monospace;
      background: #fffef3;
      padding: 5px 10px;
      border-radius: 4px;
    }

  </style>
</head>
<body>
  <div class="container">
    <a href="https://docs.google.com/document/d/1Uvp9evEQdUnysuExGtLnssGuFzhLr_4yJfv6UYCazJw/edit?usp=sharing" target="_blank"><h1>Theta Tau Attendance</h1></a>
    <div class="subtitle">You must reach 12 pts in each category</div>
    <div class="scroll-box">
      <table id="pointsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Social</th>
            <th>Service</th>
            <th>Professional</th>
            <th>Recruitment</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="popupModal" style="display:none;">
    <div class="popup-content">
      <span id="closePopup">&times;</span>
      <h2 id="popupName">Member Details</h2>

      <div class="popup-section">
        <h3>Recruitment</h3>
        <div class="popup-row" id="popupRecruitment"></div>
      </div>
      <div class="popup-section">
        <h3>Social</h3>
        <div class="popup-row" id="popupSocial"></div>
      </div>
      <div class="popup-section">
        <h3>Professional</h3>
        <div class="popup-row" id="popupProfessional"></div>
      </div>
      <div class="popup-section">
        <h3>Service</h3>
        <div class="popup-row" id="popupService"></div>
      </div>
    </div>
  </div>


  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSe8DRYLrA1sChNjnFJzaSLAIRMi3vM3ltR2kGF3BYdjjTsdMqW-_Txt8hXpQZF8ZxSH2pIxYmlvw34/pub?output=csv';
    let tableData = [];

    fetch(sheetURL)
      .then(response => response.text())
      .then(csvText => {
        const rows = csvText.trim().split('\n').map(row => row.split(','));
        const tbody = document.querySelector('#pointsTable tbody');
        tableData = rows;

        for (let i = 1; i < rows.length; i++) {
          const row = document.createElement('tr');
          let hasLow = false;

          rows[i].forEach((cell, idx) => {
            const td = document.createElement('td');
            const value = cell.trim();

            if (idx === 0) {
              td.textContent = value;
              td.classList.add('name');
            } else {
              const num = parseInt(value);
              td.textContent = isNaN(num) ? value : num;

              if (!isNaN(num) && num < 12) {
                td.classList.add('low');
                hasLow = true;
              } else if (!isNaN(num)) {
                td.classList.add('high');
              }
            }
            row.appendChild(td);
          });

          if (hasLow) {
            row.firstChild.classList.add('name-low');
          }

          // ✅ Add click handler
          row.addEventListener('click', () => showModal(rows[i]));
          tbody.appendChild(row);
        }
      });

    function showModal(originalRow) {
      const name = originalRow[0];
      document.getElementById('popupName').textContent = name;

      const recruitmentSheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSe8DRYLrA1sChNjnFJzaSLAIRMi3vM3ltR2kGF3BYdjjTsdMqW-_Txt8hXpQZF8ZxSH2pIxYmlvw34/pub?output=csv';

      fetch(recruitmentSheetURL)
        .then(response => response.text())
        .then(csvText => {
          const rows = csvText.trim().split('\n').map(r => r.split(','));
          const headers = rows[0].slice(0, 17); // A to Q (17 columns)
          const memberRow = rows.find(r => r[0].trim().toLowerCase() === name.trim().toLowerCase());

          if (!memberRow) {
            document.getElementById('popupRecruitment').innerHTML = 'No data found.';
            return;
          }

          let content = "";

          // Loop through columns A to Q (index 0 to 16)
          for (let i = 1; i <= 16; i++) {
            const colHeader = headers[i] || `(col ${i})`;
            const cellValue = memberRow[i] ? memberRow[i].trim().toUpperCase() : "";

            // Determine formatting based on rules
            const isPointColumn = [2, 4, 6, 12, 14, 16].includes(i); // C, E, G, M, O, Q
            const displayLabel = `<strong>${colHeader}</strong>`;

            if (isPointColumn) {
              // ➕ Always show points normally
              content += `<div style="margin-left:1em;">Points: ${memberRow[i] || 0}</div>`;
            } else if (cellValue === "TRUE" || cellValue === "FALSE") {
              const color = cellValue === "TRUE" ? "green" : "red";
              content += `<div style="color:${color}; font-weight:bold;">${displayLabel}</div>`;
            } else if (!isNaN(cellValue)) {
              const color = parseFloat(cellValue) > 0 ? "green" : "red";
              content += `<div style="color:${color}; font-weight:bold;">${displayLabel}</div>`;
            }
          }

          document.getElementById('popupRecruitment').innerHTML = content;
          document.getElementById('popupSocial').innerHTML = content;
          document.getElementById('popupProfessional').innerHTML = content;
          document.getElementById('popupService').innerHTML = content;

          document.getElementById('popupModal').style.display = 'flex';
        })
        .catch(error => {
          console.error('Error loading recruitment data:', error);
          document.getElementById('popupRecruitment').innerHTML = 'Error loading data.';
        });
    }


  </script>

</body>
</html>
